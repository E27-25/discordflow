Metadata-Version: 2.4
Name: discordflow
Version: 0.3.1
Summary: A lightweight MLflow clone that logs ML training metrics, parameters, and artifacts directly to Discord webhooks ‚Äî with Forum thread support.
Author-email: Watin Promfiy <watin@example.com>
License: MIT
Project-URL: Homepage, https://github.com/E27-25/discordflow
Project-URL: Bug Tracker, https://github.com/E27-25/discordflow/issues
Project-URL: Documentation, https://github.com/E27-25/discordflow#readme
Project-URL: Changelog, https://github.com/E27-25/discordflow/releases
Keywords: mlflow,discord,machine-learning,experiment-tracking,webhooks,deep-learning,forum,training-monitor
Classifier: Programming Language :: Python :: 3
Classifier: Programming Language :: Python :: 3.8
Classifier: Programming Language :: Python :: 3.9
Classifier: Programming Language :: Python :: 3.10
Classifier: Programming Language :: Python :: 3.11
Classifier: Programming Language :: Python :: 3.12
Classifier: License :: OSI Approved :: MIT License
Classifier: Operating System :: OS Independent
Classifier: Topic :: Scientific/Engineering :: Artificial Intelligence
Classifier: Topic :: System :: Logging
Classifier: Intended Audience :: Science/Research
Classifier: Intended Audience :: Developers
Requires-Python: >=3.8
Description-Content-Type: text/markdown
Requires-Dist: requests>=2.25.0
Provides-Extra: system
Requires-Dist: psutil>=5.9; extra == "system"
Provides-Extra: gpu
Requires-Dist: pynvml>=11.0; extra == "gpu"
Provides-Extra: dev
Requires-Dist: build; extra == "dev"
Requires-Dist: twine; extra == "dev"
Requires-Dist: pytest; extra == "dev"
Requires-Dist: matplotlib; extra == "dev"

# DiscordFlow üöÄ

> **The MLflow you already have open on your phone.**
> Log ML training metrics, parameters, and artifacts directly to Discord ‚Äî no server required.

![PyPI](https://img.shields.io/pypi/v/discordflow)
![Python Versions](https://img.shields.io/pypi/pyversions/discordflow)
![License](https://img.shields.io/badge/license-MIT-blue.svg)

---

## ‚ú® What's in the Box

| Feature | Details |
|---|---|
| üìà **Metrics** | `log_metric()` / `log_metrics()` per step/epoch |
| ‚öôÔ∏è **Params** | `log_param()` / `log_params()` ‚Äî logged as blue embeds |
| üè∑Ô∏è **Tags** | `set_tag()` ‚Äî arbitrary key-value labels on a run |
| üìÅ **Artifact upload** | Any file up to 25 MB via `log_artifact()` |
| üìÑ **Text artifact** | `log_text()` ‚Äî upload a string as a `.txt` / `.csv` attachment |
| üìä **Figure upload** | `log_figure(fig)` ‚Äî send `matplotlib` figures as PNG into Discord |
| üí¨ **Normal channel** | `start_run()` ‚Äî embeds posted directly in the channel |
| üìã **Forum channel** | `start_forum_run()` ‚Äî each run gets its own dedicated Discord thread |
| üîÑ **Auto-resume** | Threads are resumed automatically after Colab restarts |
| üíæ **State persistence** | `save()` stores `{run_name: thread_id}` to JSON |
| üñ•Ô∏è **System metrics** | Per-call, configurable: CPU, RAM, GPU, Disk, Network |
| ‚ö° **Async logging** | `ThreadPoolExecutor` ‚Äî Discord calls never block training |
| ‚ùå **Error capture** | Exceptions inside `with` blocks are posted to Discord |
| üñ•Ô∏è **Dry-run mode** | `dry_run=True` prints to stdout ‚Äî no real webhook calls |

---

## üì¶ Installation

```bash
# Core (no system metrics)
pip install discordflow

# + CPU, RAM, Disk, Network metrics
pip install "discordflow[system]"

# + NVIDIA GPU metrics
pip install "discordflow[system,gpu]"
```

Requires Python ‚â• 3.8.

---

## ‚ö° Quickstart

Get a webhook URL from **Discord Server Settings ‚Üí Integrations ‚Üí Webhooks ‚Üí New Webhook**.

### Normal Channel ‚Äî `start_run()`

Use when your webhook points to a regular **text / announcement channel**.

```python
from discordflow import DiscordFlow

dflow = DiscordFlow(WEBHOOK_URL, experiment_name="ResNet_Training")

with dflow.start_run("baseline") as run:
    run.log_params({"lr": 3e-4, "batch_size": 128, "epochs": 10})
    run.set_tag("dataset", "ImageNet")

    for epoch in range(1, 11):
        loss = train_one_epoch(model, ...)
        run.log_metrics(
            {"Train Loss": loss, "Val Acc": eval(model, ...)},
            step=epoch,
            system_metrics=["cpu", "ram"],   # ‚Üê hardware stats appended to each embed
        )

    run.log_artifact("best_model.pt")
    run.log_figure(fig, title="Loss Curve")

dflow.finish()  # flush async queue before exit
```

### Forum Channel ‚Äî `start_forum_run()`

Use when your webhook points to a **Forum channel**.  
Each run automatically gets its own Discord thread ‚Äî perfect for comparing many experiments.

```python
dflow = DiscordFlow(FORUM_WEBHOOK_URL, experiment_name="LLM_FineTune")

with dflow.start_forum_run("lora_r16", description="LoRA rank=16 sweep") as run:
    run.log_params({"lora_rank": 16, "lr": 2e-4, "epochs": 3})

    for epoch in range(1, 4):
        run.log_metrics(
            {"Train Loss": ..., "Val Loss": ...},
            step=epoch,
            system_metrics=["cpu", "ram", "gpu"],  # ‚Üê GPU stats for Colab/NVIDIA
        )
        run.log_figure(fig, title=f"Epoch {epoch} curve")

# ‚úÖ Summary + elapsed + final metrics auto-posted to the thread

dflow.save()    # ‚Üê persist thread IDs so you can resume after a restart
dflow.finish()
```

> ‚ö†Ô∏è **Wrong channel type?** If you call `start_run()` on a Forum webhook (or vice versa), DiscordFlow will raise a `WebhookError` with a message telling you exactly which method to switch to.

---

## üñ•Ô∏è Configurable System Metrics

Pass any combination to `system_metrics=` on `log_metrics()`:

| Key | Logged value | Requires |
|---|---|---|
| `"cpu"` | Usage % + clock speed | `discordflow[system]` |
| `"ram"` | Usage % + GB used / total | `discordflow[system]` |
| `"gpu"` | Util % + VRAM used / total, per GPU | `discordflow[system,gpu]` |
| `"disk"` | Usage % + GB used / total | `discordflow[system]` |
| `"network"` | Total MB ‚Üë sent / ‚Üì received | `discordflow[system]` |

```python
# Minimal ‚Äî CPU + RAM only
run.log_metrics({"loss": 0.4}, step=1, system_metrics=["cpu", "ram"])

# Everything
run.log_metrics({"loss": 0.4}, step=1,
    system_metrics=["cpu", "ram", "gpu", "disk", "network"])
```

---

## üíæ Colab Restart Recovery

When your Colab runtime reconnects, thread IDs are restored automatically from the saved state file:

```python
# Fresh runtime ‚Äî state_file is loaded automatically on __init__
dflow = DiscordFlow(FORUM_WEBHOOK_URL, "LLM_FineTune",
                   state_file=".discordflow_state.json")  # default path

# start_forum_run now resumes the existing thread instead of creating a new one
with dflow.start_forum_run("lora_r16") as run:
    ...
```

**Manual override** (if you know the thread ID):
```python
dflow.resume_run("lora_r16", thread_id="1234567890123456789")
dflow.save()
```

**ZIP backup** (download to PC, re-upload on next Colab session):
```python
from discordflow.colab_utils import export_session, import_session

export_session(dflow)   # ‚Üê downloads discordflow_backup.zip to your machine
# --- On a fresh Colab runtime ---
import_session(dflow)   # ‚Üê upload the zip to restore all thread IDs
```

---

## üé® Custom Bot Identity

```python
dflow = DiscordFlow(
    webhook_url     = WEBHOOK_URL,
    experiment_name = "ResNet_Training",
    username        = "TrainBot üèãÔ∏è",
    avatar_url      = "https://i.imgur.com/AfFp7pu.png",
)
```

---

## üìö Full API Reference

### `DiscordFlow(webhook_url, experiment_name, ...)`

| Parameter | Default | Description |
|---|---|---|
| `webhook_url` | required | Discord webhook URL |
| `experiment_name` | `"Default Experiment"` | Shown in every embed footer |
| `state_file` | `".discordflow_state.json"` | JSON path for thread ID persistence (`None` to disable) |
| `async_logging` | `True` | Non-blocking background thread for webhook calls |
| `dry_run` | `False` | Print embeds to stdout, no actual HTTP requests |
| `username` | `"DiscordFlow ü§ñ"` | Bot display name in Discord |
| `avatar_url` | `None` | Bot profile picture URL |

### Channel Methods

| Method | Channel | Returns | Description |
|---|---|---|---|
| `start_run(run_name)` | Normal | `ActiveRun` | Start a run, post embeds to channel |
| `start_forum_run(run_name, description)` | Forum | `ForumActiveRun` | Create/resume a forum thread for this run |
| `resume_run(run_name, thread_id)` | Forum | ‚Äî | Manually re-link a run name to an existing thread |
| `save(filepath=None)` | Both | ‚Äî | Persist `{run_name: thread_id}` to JSON |
| `finish()` | Both | ‚Äî | Flush async queue and shut down executor |

### Logging Methods (on `ActiveRun` & `ForumActiveRun`)

```python
run.log_param("lr", 3e-4)
run.log_params({"lr": 3e-4, "batch": 128, "optimizer": "AdamW"})
run.log_metric("loss", 0.42, step=5)
run.log_metrics({"loss": 0.42, "acc": 0.91}, step=5,
               system_metrics=["cpu", "ram"])
run.set_tag("author", "e27")
run.log_artifact("checkpoint.pt")
run.log_text("epoch,loss\n1,1.0\n2,0.5", filename="loss.csv")
run.log_figure(fig, title="Loss Curve")
```

### Exceptions

| Exception | When raised |
|---|---|
| `WebhookError` | Discord HTTP error (wrong channel type, network issue) |
| `ArtifactTooLargeError` | File exceeds 25 MB Discord limit |
| `RunNotActiveError` | Operation attempted with no active run |

---

## üß™ Local Testing (Dry Run)

```python
dflow = DiscordFlow("ANY_URL", "test", dry_run=True)
with dflow.start_run("test_run") as run:
    run.log_metrics({"loss": 0.42, "acc": 0.91}, step=1)
```

Output is printed to stdout ‚Äî no real HTTP calls, no webhook URL needed.

---

## üóÇÔ∏è Project Layout

```
discordflow/
‚îú‚îÄ‚îÄ core.py          # DiscordFlow main class
‚îú‚îÄ‚îÄ run.py           # ActiveRun + ForumActiveRun context managers
‚îú‚îÄ‚îÄ utils.py         # Colour palette, formatters, collect_system_metrics()
‚îú‚îÄ‚îÄ exceptions.py    # Custom exception hierarchy
‚îú‚îÄ‚îÄ colab_utils.py   # export_session / import_session for Colab
‚îî‚îÄ‚îÄ __init__.py      # Public API surface
colab_demo.py        # Full runnable Colab demo (switchable normal/forum mode)
example.py           # Minimal dry-run example
```

---

## ü§ù Contributing

```bash
git clone https://github.com/E27-25/discordflow.git
cd discordflow-project
pip install -e ".[dev]"
```

1. Fork ‚Üí feature branch ‚Üí PR.
2. Keep PRs focused; match the existing code style.

---

## üë§ Author

**Watin Promfiy**
- GitHub: [@E27-25](https://github.com/E27-25)
- Project: [github.com/E27-25/discordflow](https://github.com/E27-25/discordflow)

---

## üìÑ License

MIT ¬© Watin Promfiy
